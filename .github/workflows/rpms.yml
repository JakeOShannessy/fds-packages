on: [push, pull_request]

name: Continuous integration

jobs:
  build-rpm:
    name: Build RPM
    runs-on: ubuntu-latest
    strategy:
      matrix:
        container: ["fedora:35"]
        # container: ["fedora:35","centos:8.4.2105"]
    container: ${{ matrix.container }}
    steps:
      - uses: actions/checkout@v2
      - name: Add intel RPM repo
        run: |
          tee > /tmp/oneAPI.repo << EOF
          [oneAPI]
          name=IntelÂ® oneAPI repository
          baseurl=https://yum.repos.intel.com/oneapi
          enabled=1
          gpgcheck=1
          repo_gpgcheck=1
          gpgkey=https://yum.repos.intel.com/intel-gpg-keys/GPG-PUB-KEY-INTEL-SW-PRODUCTS.PUB
          EOF
          mv /tmp/oneAPI.repo /etc/yum.repos.d
      - name: install prerequisites
        run: yum install -y git gcc procps kmod openssl-devel cargo rpmdevtools make
      - run: yum install -y intel-basekit intel-hpckit
      - name: Create archive
        run: |
          make -f Makefile.fedora
